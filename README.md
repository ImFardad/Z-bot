# 🤖 Z-Bot: ربات بقا در آخرالزمان زامبی (Node.js)

این پروژه یک ربات تلگرام است که با استفاده از Node.js، کتابخانه `node-telegram-bot-api` و مدل هوش مصنوعی Gemini گوگل ساخته شده است. ربات، کاربران را در سناریوهای واقع‌گرایانه بقا در دنیای زامبی‌زده قرار می‌دهد و راه حل‌های آن‌ها را بر اساس خلاقیت، کارآمدی و دیگر مهارت‌های بقا ارزیابی می‌کند. همچنین دارای سیستم "پناهگاه" است که به کاربران اجازه می‌دهد در گروه‌ها تیم تشکیل دهند.

---

## قابلیت‌ها

- **🧟 سناریوهای بقا:** تولید سناریوهای چالش‌برانگیز و واقع‌گرایانه با استفاده از Gemini AI.
- **🧠 ارزیابی هوشمند:** تحلیل و امتیازدهی به راه حل‌های کاربران بر اساس معیارهای مختلف بقا.
- **🏕️ سیستم پناهگاه:**
    - ایجاد پناهگاه در گروه‌های تلگرام از طریق یک فرآیند چندمرحله‌ای (فقط توسط ادمین‌ها).
    - **مکان‌یابی هوشمند:** پیدا کردن یک مکان دقیق، قابل شناسایی و غیرمذهبی برای پناهگاه با استفاده از هوش مصنوعی.
    - نمایش اطلاعات کامل پناهگاه (نام، استان، شهر، مکان دقیق و لیست اعضا).
    - امکان پیوستن به پناهگاه یا خروج از آن.
- **📊 درصد بقا:** هر کاربر یک "درصد بقا" دارد که بر اساس عملکرد او در سناریو‌ها آپدیت می‌شود.
- **⚙️ مدیریت کلید API:** قابلیت تعریف چندین کلید API برای Gemini و چرخش خودکار بین آن‌ها.
- **🤖 مدیریت هوشمند گروه:** پاک‌سازی خودکار اطلاعات پناهگاه در صورت حذف شدن ربات از گروه.
- **🛡️ کنترل دسترسی:** کاربران برای استفاده از هر قابلیتی در گروه باید ابتدا ربات را در چت خصوصی استارت کرده باشند.

---

## ساختار پروژه

```
z-bot/
│
├── db/
│   ├── database.js         # تنظیمات اتصال به دیتابیس (Sequelize)
│   ├── User.js             # مدل کاربر (User)
│   ├── Shelter.js          # مدل پناهگاه (Shelter)
│   └── UserQuestionHistory.js # مدل تاریخچه سناریوهای کاربر
│
├── handlers/
│   ├── menuHandler.js      # مدیریت دکمه‌های منوی اصلی
│   ├── shelterCreationHandler.js # مدیریت فرآیند ساخت و عضویت پناهگاه
│   ├── shelterHandler.js   # مدیریت منوی پناهگاه در چت خصوصی
│   ├── startHandler.js     # مدیریت دستور /start
│   └── zombieHandler.js    # مدیریت سناریوهای زامبی
│
├── iran/
│   ├── cities.json         # لیست شهرهای ایران
│   └── provinces.json      # لیست استان‌های ایران
│
├── keyboards/
│   └── inlineKeyboards.js  # ساخت کیبوردهای داینامیک
│
├── services/
│   └── geminiService.js    # سرویس ارتباط با Gemini AI
│
├── .env.example            # نمونه فایل متغیرهای محیطی
├── bot.js                  # منطق اصلی و راه‌اندازی ربات
├── index.js                # نقطه شروع برنامه
├── package.json
└── README.md
```

---

## راه‌اندازی و نصب

### ۱. پیش‌نیازها
- [Node.js](https://nodejs.org/) نسخه ۱۸ یا بالاتر

### ۲. نصب نیازمندی‌ها

```sh
npm install
```

---

## پیکربندی

یک فایل `.env.example` در پروژه قرار دارد. یک کپی از آن با نام `.env` ایجاد کرده و مقادیر زیر را در آن قرار دهید:

```env
# توکن ربات تلگرام دریافتی از BotFather
TELEGRAM_TOKEN="YOUR_TELEGRAM_TOKEN"

# کلیدهای API برای سرویس Gemini گوگل (با کاما از هم جدا کنید)
GEMINI_API_KEYS="YOUR_GEMINI_KEY_1,YOUR_GEMINI_KEY_2"

# شناسه عددی کاربری که ادمین ربات خواهد بود (اختیاری)
ADMIN_USER_ID="YOUR_TELEGRAM_USER_ID"

# نام مدل Gemini مورد استفاده (اختیاری، پیش‌فرض: gemini-1.5-flash)
GEMINI_MODEL_NAME=gemini-1.5-flash
```
- برای پیدا کردن شناسه کاربری خود، می‌توانید به ربات [userinfobot](https://t.me/userinfobot) پیام دهید.

---

## نحوه استفاده

### دستورات اصلی
- `/start`:
    - **در چت خصوصی:** ربات را استارت کرده، شما را در سیستم ثبت می‌کند و منوی اصلی را نمایش می‌دهد.
    - **در گروه:** به شما یادآوری می‌کند که برای استفاده از ربات باید آن را در چت خصوصی استارت کرده باشید.
- `/shelter`:
    - **(فقط در گروه)** اگر پناهگاهی وجود نداشته باشد و شما ادمین باشید، فرآیند ساخت پناهگاه جدید (شامل ۴ مرحله نام، استان، شهر و مکان‌یابی هوشمند) را آغاز می‌کند.
    - **(فقط در گروه)** اگر پناهگاه وجود داشته باشد، اطلاعات کامل آن (شامل مکان دقیق و اعضا) را به همراه دکمه عضویت نمایش می‌دهد.

### منوی اصلی (در چت خصوصی)
- **🧟 سناریو زامبی:** یک سناریوی جدید برای حل کردن دریافت می‌کنید.
- **🏕️ پناهگاه:** وضعیت عضویت و اطلاعات پناهگاه خود را مشاهده می‌کنید.
- **🏆 احتمال بقا:** درصد بقای کلی شما را نمایش می‌دهد.

---

## اجرای ربات

برای اجرای ربات:
```sh
npm start
```

برای اجرای ربات در حالت توسعه (که با هر تغییر کد، به طور خودکار ری‌استارت می‌شود):
```sh
npm run dev
```
