# 🤖 Z-Bot: ربات بقا در آخرالزمان زامبی (Node.js)

این پروژه یک ربات تلگرام است که با استفاده از Node.js، کتابخانه `node-telegram-bot-api` و مدل هوش مصنوعی Gemini گوگل ساخته شده است. ربات، کاربران را در سناریوهای واقع‌گرایانه بقا در دنیای زامبی‌زده قرار می‌دهد و راه حل‌های آن‌ها را بر اساس خلاقیت، کارآمدی و دیگر مهارت‌های بقا ارزیابی می‌کند. همچنین دارای سیستم "پناهگاه" است که به کاربران اجازه می‌دهد در گروه‌ها تیم تشکیل دهند.

---

## قابلیت‌ها

- **🧟 سناریوهای بقا:** تولید سناریوهای چالش‌برانگیز و واقع‌گرایانه با استفاده از Gemini AI.
- **🧠 ارزیابی هوشمند:** تحلیل و امتیازدهی به راه حل‌های کاربران بر اساس معیارهای مختلف بقا (کاربردی بودن، خلاقیت، مدیریت ریسک و...).
- **🏕️ سیستم پناهگاه:**
    - گروه‌های تلگرام می‌توانند به عنوان "پناهگاه" ثبت شوند.
    - کاربران می‌توانند به پناهگاه‌ها ملحق شده یا آن را ترک کنند.
    - امکان مشاهده لیست اعضای هر پناهگاه.
- **📊 درصد بقا:** هر کاربر یک "درصد بقا" دارد که بر اساس عملکرد او در سناریو‌ها آپدیت می‌شود.
- **⚙️ مدیریت کلید API:** قابلیت تعریف چندین کلید API برای Gemini و چرخش خودکار بین آن‌ها در صورت اتمام سهمیه روزانه.
- **ناوبری روان:** منوهای تو در تو با قابلیت بازگشت و رفرش برای تجربه کاربری بهتر.

---

## ساختار پروژه

```
z-bot/
│
├── db/
│   ├── database.js         # تنظیمات اتصال به دیتابیس (Sequelize)
│   ├── User.js             # مدل کاربر (User)
│   ├── Shelter.js          # مدل پناهگاه (Shelter)
│   ├── UserPossibleShelter.js # مدل کمکی برای پناهگاه‌های ممکن
│   └── UserQuestionHistory.js # مدل تاریخچه سناریوهای کاربر
│
├── handlers/
│   ├── menuHandler.js      # مدیریت دکمه‌های منو
│   ├── shelterHandler.js   # مدیریت منطق پناهگاه
│   ├── startHandler.js     # مدیریت دستور /start
│   └── zombieHandler.js    # مدیریت سناریوهای زامبی
│
├── keyboards/
│   └── inlineKeyboards.js  # ساخت کیبوردهای داینامیک
│
├── services/
│   └── geminiService.js    # سرویس ارتباط با Gemini AI
│
├── .env                    # (باید ساخته شود) فایل متغیرهای محیطی
├── bot.js                  # منطق اصلی و راه‌اندازی ربات
├── index.js                # نقطه شروع برنامه
├── package.json
└── README.md
```

---

## راه‌اندازی و نصب

### ۱. پیش‌نیازها
- [Node.js](https://nodejs.org/) نسخه ۱۸ یا بالاتر

### ۲. نصب نیازمندی‌ها
```sh
npm install
```

---

## پیکربندی

یک فایل `.env.example` در پروژه قرار دارد. یک کپی از آن با نام `.env` ایجاد کرده و مقادیر زیر را در آن قرار دهید:

```env
# توکن ربات تلگرام دریافتی از BotFather
TELEGRAM_TOKEN="YOUR_TELEGRAM_TOKEN"

# کلیدهای API برای سرویس Gemini گوگل (با کاما از هم جدا کنید)
GEMINI_API_KEYS="YOUR_GEMINI_KEY_1,YOUR_GEMINI_KEY_2"

# شناسه عددی کاربری که ادمین ربات خواهد بود (اختیاری)
ADMIN_USER_ID="YOUR_TELEGRAM_USER_ID"

# تعداد سناریوهای اخیری که برای جلوگیری از تکرار در حافظه نگهداری می‌شوند
SCENARIO_HISTORY_LIMIT=5
```
- برای پیدا کردن شناسه کاربری خود، می‌توانید به ربات [userinfobot](https://t.me/userinfobot) پیام دهید.

---

## نحوه استفاده

### دستورات اصلی
- `/start`:
    - در چت خصوصی: ربات را استارت کرده و منوی اصلی را نمایش می‌دهد.
    - در گروه: گروه را به عنوان یک "پناهگاه" ثبت می‌کند.
- `/shelter_members`:
    - (فقط در گروه پناهگاه) لیست اعضای پناهگاه را نمایش می‌دهد.

### منوی اصلی
- **🧟 سناریو زامبی:** یک سناریوی جدید برای حل کردن دریافت می‌کنید.
- **🏕️ پناهگاه:** پناهگاه فعلی خود را مشاهده کرده، به یک پناهگاه جدید ملحق شوید یا از آن خارج شوید.
- **🏆 احتمال بقا:** درصد بقای کلی شما را نمایش می‌دهد.

---

## اجرای ربات

برای اجرای ربات در حالت توسعه (با Nodemon):
```sh
npm run dev
```
برای اجرای ربات در حالت عادی:
```sh
node index.js
```
