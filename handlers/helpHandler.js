async function handleHelpCommand(bot, msg) {
  const chatId = msg.chat.id;

  // Build the help text using string concatenation to avoid potential template literal parsing issues.
  let helpText = ''
  helpText += '** راهنمای جامع ربات Z-Bot **\n\n';
  helpText += 'به دنیای آخرالزمانی Z-Bot خوش آمدید! در ادامه نحوه استفاده از امکانات مختلف ربات توضیح داده می‌شود.\n\n';
  helpText += '---\n\n';
  helpText += '**۱. شروع کار**\n\n';
  helpText += 'برای استفاده از تمام امکانات ربات، ابتدا باید آن را در **چت خصوصی** استارت کنید. به پیوی ربات رفته و دستور زیر را ارسال کنید:\n';
  helpText += '`/start`\n\n';
  helpText += 'با این کار، شما به عنوان یک بازمانده در سیستم ثبت شده و منوی اصلی برایتان نمایش داده می‌شود.\n\n';
  helpText += '---\n\n';
  helpText += '**۲. سیستم پناهگاه (فقط در گروه‌ها)**\n\n';
  helpText += 'پناهگاه‌ها مرکز اصلی فعالیت‌های گروهی هستند.\n\n';
  helpText += '- **ساخت پناهگاه:**\n';
  helpText += '  برای ساخت یک پناهگاه، ربات را به گروه خود اضافه کرده و دستور زیر را ارسال کنید. (توجه: فقط ادمین‌های گروه می‌توانند پناهگاه بسازند)\n';
  helpText += '  `/shelter`\n';
  helpText += '  با اجرای این دستور، فرآیند ۴ مرحله‌ای ساخت پناهگاه (انتخاب نام، استان، شهر و مکان‌یابی هوشمند) آغاز می‌شود.\n\n';
  helpText += '- **مشاهده اطلاعات و عضویت:**\n';
  helpText += '  اگر در گروهی که پناهگاه دارد دستور `/shelter` را بزنید، اطلاعات آن به همراه دکمه «پیوستن به پناهگاه» نمایش داده می‌شود.\n\n';
  helpText += '- **مدیریت پناهگاه:**\n';
  helpText += '  اعضای یک پناهگاه می‌توانند با دستور زیر، منوی مدیریت را باز کنند:\n';
  helpText += '  `/manage_shelter`\n\n';
  helpText += '  در این منو می‌توانید:\n';
  helpText += '  - **خزانه:** موجودی سکه پناهگاه را ببینید و به آن سکه اهدا کنید.\n';
  helpText += '  - **تانکر سوخت:** موجودی سوخت پناهگاه را ببینید، به آن سوخت اهدا کنید یا آن را ارتقا دهید.\n\n';
  helpText += '---\n\n';
  helpText += '**۳. منوی اصلی (در چت خصوصی)**\n\n';
  helpText += '- **🧟 سناریو زامبی:** یک سناریوی بقا دریافت کرده و با ارسال راه حل خود، "درصد بقا"ی خود را افزایش دهید.\n';
  helpText += '- **🏕️ پناهگاه:** اطلاعات پناهگاهی که در آن عضو هستید را مشاهده کرده یا از آن خارج شوید.\n';
  helpText += '- **🛒 فروشگاه:** تجهیزات مورد نیاز خود را بخرید:\n';
  helpText += '  - **کوله پشتی:** کوله پشتی خود را بخرید یا آن را برای ظرفیت بیشتر ارتقا دهید.\n';
  helpText += '  - **آیتم‌های روزانه:** آیتم‌هایی مانند آب، باتری و سوخت که دارای سهمیه خرید روزانه هستند.\n';
  helpText += '- **🎒 کوله پشتی:** (در صورت داشتن) ظرفیت و محتویات کوله پشتی و همچنین موجودی سوخت خود را مشاهده کنید.\n';
  helpText += '- **🏆 احتمال بقا:** امتیاز کلی بقای خود را ببینید.';

  try {
    await bot.sendMessage(chatId, helpText, { parse_mode: 'Markdown' });
  } catch (error) {
    console.error('Error sending help message:', error);
  }
}

module.exports = { handleHelpCommand };